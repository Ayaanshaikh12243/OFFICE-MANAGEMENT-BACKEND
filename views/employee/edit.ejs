<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - Office Management System</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  
  <%- include('../partials/header') %>
  <%- include('../partials/messages') %>
  
  <div class="container mt-4">
    <!-- Header -->
    <div class="row mb-4">
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="/employees">Employees</a></li>
            <li class="breadcrumb-item active">Edit Employee</li>
          </ol>
        </nav>
        <h2><i class="bi bi-pencil"></i> Edit Employee</h2>
      </div>
    </div>
    
    <!-- Form -->
    <div class="row">
      <div class="col-lg-10 mx-auto">
        <div class="card">
          <div class="card-body">
            <form action="/employees/edit/<%= employee._id %>" method="POST">
              <!-- Personal Information -->
              <h5 class="mb-3"><i class="bi bi-person"></i> Personal Information</h5>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="firstName" class="form-label">First Name <span class="text-danger">*</span></label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="firstName" 
                    name="firstName" 
                    value="<%= employee.firstName %>"
                    required
                  >
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="lastName" class="form-label">Last Name <span class="text-danger">*</span></label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="lastName" 
                    name="lastName" 
                    value="<%= employee.lastName %>"
                    required
                  >
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                  <input 
                    type="email" 
                    class="form-control" 
                    id="email" 
                    name="email" 
                    value="<%= employee.email %>"
                    required
                  >
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="phone" class="form-label">Phone <span class="text-danger">*</span></label>
                  <input 
                    type="tel" 
                    class="form-control" 
                    id="phone" 
                    name="phone" 
                    value="<%= employee.phone %>"
                    required
                  >
                </div>
              </div>
              
              <hr class="my-4">
              
              <!-- Job Information -->
              <h5 class="mb-3"><i class="bi bi-briefcase"></i> Job Information</h5>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="jobTitle" class="form-label">Job Title <span class="text-danger">*</span></label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="jobTitle" 
                    name="jobTitle" 
                    value="<%= employee.jobTitle %>"
                    required
                  >
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="department" class="form-label">Department <span class="text-danger">*</span></label>
                  <select class="form-select" id="department" name="department" required>
                    <option value="">Select Department</option>
                    <% departments.forEach(dept => { %>
                      <option value="<%= dept._id %>" 
                        <%= employee.department._id.toString() === dept._id.toString() ? 'selected' : '' %>>
                        <%= dept.name %>
                      </option>
                    <% }); %>
                  </select>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="salary" class="form-label">Salary <span class="text-danger">*</span></label>
                  <input 
                    type="number" 
                    class="form-control" 
                    id="salary" 
                    name="salary" 
                    min="0"
                    value="<%= employee.salary %>"
                    required
                  >
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="dateOfJoining" class="form-label">Date of Joining <span class="text-danger">*</span></label>
                  <input 
                    type="date" 
                    class="form-control" 
                    id="dateOfJoining" 
                    name="dateOfJoining" 
                    value="<%= new Date(employee.dateOfJoining).toISOString().split('T')[0] %>"
                    required
                  >
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="supervisor" class="form-label">Supervisor</label>
                  <select class="form-select" id="supervisor" name="supervisor">
                    <option value="">No Supervisor</option>
                    <% employees.forEach(emp => { %>
                      <option value="<%= emp._id %>" 
                        <%= employee.supervisor && employee.supervisor._id.toString() === emp._id.toString() ? 'selected' : '' %>>
                        <%= emp.firstName %> <%= emp.lastName %>
                      </option>
                    <% }); %>
                  </select>
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="status" class="form-label">Status <span class="text-danger">*</span></label>
                  <select class="form-select" id="status" name="status" required>
                    <option value="active" <%= employee.status === 'active' ? 'selected' : '' %>>Active</option>
                    <option value="inactive" <%= employee.status === 'inactive' ? 'selected' : '' %>>Inactive</option>
                    <option value="on-leave" <%= employee.status === 'on-leave' ? 'selected' : '' %>>On Leave</option>
                  </select>
                </div>
              </div>
              
              <hr class="my-4">
              
              <!-- Location Information -->
              <h5 class="mb-3"><i class="bi bi-geo-alt"></i> Location Information</h5>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="country" class="form-label">Country <span class="text-danger">*</span></label>
                  <select class="form-select" id="country" name="country" required>
                    <option value="<%= employee.country %>"><%= employee.country %></option>
                  </select>
                </div>
                
                <div class="col-md-4 mb-3">
                  <label for="state" class="form-label">State <span class="text-danger">*</span></label>
                  <select class="form-select" id="state" name="state" required>
                    <option value="<%= employee.state %>"><%= employee.state %></option>
                  </select>
                </div>
                
                <div class="col-md-4 mb-3">
                  <label for="city" class="form-label">City <span class="text-danger">*</span></label>
                  <select class="form-select" id="city" name="city" required>
                    <option value="<%= employee.city %>"><%= employee.city %></option>
                  </select>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="address" class="form-label">Address <span class="text-danger">*</span></label>
                <textarea 
                  class="form-control" 
                  id="address" 
                  name="address" 
                  rows="3"
                  required
                ><%= employee.address %></textarea>
              </div>
              
              <hr class="my-4">
              
              <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <a href="/employees" class="btn btn-secondary">
                  <i class="bi bi-x-circle"></i> Cancel
                </a>
                <button type="submit" class="btn btn-primary">
                  <i class="bi bi-check-circle"></i> Update Employee
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <%- include('../partials/footer') %>
  
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Location API Script -->
  <script src="/js/location.js"></script>
  
  <!-- Pre-populate location data -->
  <script>
    // Store existing location data
    window.existingLocation = {
      country: '<%= employee.country %>',
      state: '<%= employee.state %>',
      city: '<%= employee.city %>'
    };
  </script>
  <script src="/js/main.js"></script>
</body>
</html>
